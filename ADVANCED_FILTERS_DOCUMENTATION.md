# الفلاتر المتقدمة لقائمة أولياء الأمور

## نظرة عامة
تم تطوير نظام فلاتر متقدم وديناميكي لقائمة أولياء الأمور يوفر إمكانيات بحث وتصفية شاملة مع واجهة مستخدم حديثة وسهلة الاستخدام.

## الميزات الجديدة

### 1. الفلاتر الديناميكية القابلة للطي والفتح
- **زر الفلاتر المتقدمة**: يمكن إظهار وإخفاء قسم الفلاتر بنقرة واحدة
- **أيقونة ديناميكية**: تتغير الأيقونة (سهم لأعلى/لأسفل) حسب حالة الفلاتر
- **تصميم أنيق**: قسم الفلاتر معروض في بطاقة منفصلة بخلفية فاتحة

### 2. فلاتر تواريخ ميلاد الأبناء
- **البحث بالفترة الزمنية**: إمكانية تحديد فترة زمنية لتواريخ ميلاد الأبناء
- **تاريخ من**: البحث عن الأبناء المولودين من تاريخ معين
- **تاريخ إلى**: البحث عن الأبناء المولودين حتى تاريخ معين
- **مثال**: البحث عن أولياء أمور لديهم أبناء ولدوا بين 2020-02-03 و 2035-03-23

### 3. فلاتر عدد الزوجات
- **نطاق العدد**: البحث حسب عدد الزوجات من رقم إلى رقم
- **حد أدنى**: تحديد الحد الأدنى لعدد الزوجات (من 0 إلى 4)
- **حد أقصى**: تحديد الحد الأقصى لعدد الزوجات (من 0 إلى 4)
- **مثال**: البحث عن أولياء أمور لديهم من 1 إلى 3 زوجات

### 4. فلاتر عدد أفراد العائلة
- **نطاق الأفراد**: البحث حسب إجمالي عدد أفراد العائلة
- **حد أدنى**: تحديد الحد الأدنى لعدد أفراد العائلة
- **حد أقصى**: تحديد الحد الأقصى لعدد أفراد العائلة
- **حساب تلقائي**: يشمل ولي الأمر + الزوجات + الأبناء

### 5. الفلاتر الأساسية المحسنة
- **البحث حسب الحي**: قائمة منسدلة بجميع الأحياء المتاحة
- **الحالة الاجتماعية**: فلترة حسب (متزوج، أرمل، مطلق، أعزب)
- **حالة الإقامة**: فلترة حسب (مقيم، نازح)

## واجهة المستخدم المحسنة

### 1. شريط البحث السريع
- **بحث نصي**: البحث بالاسم أو رقم الهوية أو رقم الجوال
- **حفظ الفلاتر**: يحتفظ بالفلاتر المطبقة عند البحث النصي
- **زر مسح**: إمكانية مسح البحث النصي بسرعة

### 2. مؤشر الفلاتر النشطة
- **عرض بصري**: يظهر جميع الفلاتر المطبقة حالياً
- **شارات ملونة**: كل فلتر معروض في شارة زرقاء منفصلة
- **معلومات واضحة**: عرض اسم الفلتر والقيمة المحددة

### 3. أزرار التحكم
- **تطبيق الفلاتر**: زر أزرق لتطبيق جميع الفلاتر المحددة
- **مسح الفلاتر**: زر رمادي لمسح جميع الفلاتر المتقدمة
- **مسح جميع الفلاتر**: زر برتقالي يظهر عند وجود فلاتر نشطة

### 4. الإحصائيات المحسنة
- **إجمالي أولياء الأمور**: العدد الكلي بعد تطبيق الفلاتر
- **المقيمون**: عدد أولياء الأمور المقيمين
- **النازحون**: عدد أولياء الأمور النازحين
- **إجمالي أفراد العائلات**: مجموع جميع أفراد العائلات

## التحسينات التقنية

### 1. معالجة البيانات
```python
# فلتر تواريخ ميلاد الأبناء
if children_birth_from or children_birth_to:
    children_filter = Q()
    if children_birth_from:
        children_filter &= Q(children__birth_date__gte=children_birth_from)
    if children_birth_to:
        children_filter &= Q(children__birth_date__lte=children_birth_to)
    guardians = guardians.filter(children_filter).distinct()
```

### 2. الحفاظ على المعاملات
- **URL Parameters**: جميع الفلاتر محفوظة في رابط الصفحة
- **التنقل بين الصفحات**: الفلاتر محفوظة عند التنقل
- **مشاركة الروابط**: يمكن مشاركة رابط الصفحة مع الفلاتر المطبقة

### 3. التفاعل الديناميكي
```javascript
// تطبيق الفلاتر تلقائياً عند التغيير
filterInputs.forEach(input => {
    input.addEventListener('change', function() {
        setTimeout(() => {
            document.getElementById('advancedFiltersForm').submit();
        }, 500);
    });
});
```

## أمثلة الاستخدام

### مثال 1: البحث عن أولياء أمور لديهم أطفال في سن المدرسة
- **تاريخ ميلاد الأبناء من**: 2010-01-01
- **تاريخ ميلاد الأبناء إلى**: 2018-12-31
- **النتيجة**: جميع أولياء الأمور الذين لديهم أطفال بين 6-14 سنة

### مثال 2: البحث عن العائلات الكبيرة في حي معين
- **الحي**: الرمال
- **عدد أفراد العائلة من**: 8
- **النتيجة**: العائلات الكبيرة (8+ أفراد) في حي الرمال

### مثال 3: البحث عن النازحين متعددي الزوجات
- **حالة الإقامة**: نازح
- **عدد الزوجات من**: 2
- **النتيجة**: أولياء الأمور النازحين الذين لديهم زوجتان أو أكثر

## الفوائد

### 1. للمستخدمين
- **سهولة الاستخدام**: واجهة بديهية وواضحة
- **مرونة في البحث**: إمكانيات بحث متنوعة ومتقدمة
- **توفير الوقت**: نتائج سريعة ودقيقة

### 2. للإدارة
- **تقارير مفصلة**: إمكانية إنتاج تقارير محددة
- **إحصائيات دقيقة**: بيانات محدثة حسب الفلاتر المطبقة
- **اتخاذ قرارات**: معلومات مفيدة لاتخاذ القرارات

### 3. للنظام
- **أداء محسن**: استعلامات قاعدة بيانات محسنة
- **قابلية التوسع**: سهولة إضافة فلاتر جديدة
- **صيانة سهلة**: كود منظم وموثق

## التطوير المستقبلي

### إضافات مقترحة
1. **فلتر العمر**: البحث حسب أعمار الأبناء مباشرة
2. **فلتر الجنس**: البحث حسب جنس الأبناء (ذكور/إناث)
3. **فلتر المهنة**: البحث حسب مهنة ولي الأمر
4. **تصدير النتائج**: تصدير النتائج المفلترة إلى Excel/PDF
5. **حفظ الفلاتر**: إمكانية حفظ مجموعات فلاتر مفضلة

### تحسينات تقنية
1. **البحث المباشر**: نتائج فورية أثناء الكتابة
2. **فلاتر ذكية**: اقتراحات تلقائية للفلاتر
3. **إحصائيات متقدمة**: رسوم بيانية للنتائج
4. **تنبيهات**: تنبيهات عند تطابق معايير معينة

---

**تاريخ التحديث**: مايو 2025  
**الإصدار**: 2.0  
**المطور**: نظام إدارة المساعدات 