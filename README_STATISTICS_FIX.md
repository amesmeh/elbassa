# ุฅุตูุงุญ ูุดููุฉ ุงูุฅุญุตุงุฆูุงุช - ูุธุงู ุฅุฏุงุฑุฉ ุงููุณุงุนุฏุงุช

## ุงููุดููุฉ

ูุงู ููุงู ุฎุทุฃ ูู ุตูุญุฉ ุงูุฅุญุตุงุฆูุงุช ูุงูุชูุงุฑูุฑ:

```
OperationalError at /reports/
near "FROM": syntax error
```

## ุณุจุจ ุงููุดููุฉ

ุงููุดููุฉ ูุงูุช ูู ุงูุงุณุชุนูุงูุงุช ุงููุนูุฏุฉ ูู `reports/views.py` ุงูุชู ุชุณุชุฎุฏู:

1. **ุงุณุชุนูุงู EXTRACT**: 
   ```python
   Martyr.objects.extra(select={'year': 'EXTRACT(year FROM martyrdom_date)'})
   ```

2. **ุงุณุชุนูุงู COUNT ูุนูุฏ**:
   ```python
   District.objects.annotate(
       total_cases=Count('guardian') + Count('martyr') + Count('injured') + 
                  Count('medicalrecord') + Count('damage') + Count('orphan')
   )
   ```

3. **ุงุณุชุนูุงู aggregate ูุนูุฏ**:
   ```python
   CivilRegistry.objects.aggregate(total=Count('family_members_count'))
   ```

ูุฐู ุงูุงุณุชุนูุงูุงุช ุชุณุจุจ ูุดุงูู ูู SQLite ูุน Django 5.2.1.

## ุงูุญู ุงููุทุจู

### 1. ุชุจุณูุท ุงุณุชุนูุงูุงุช ุงูุณูุฉ
```python
# ูุจู ุงูุฅุตูุงุญ
'martyrs_by_year': Martyr.objects.extra(
    select={'year': 'EXTRACT(year FROM martyrdom_date)'}
).values('year').annotate(count=Count('id')).order_by('-year'),

# ุจุนุฏ ุงูุฅุตูุงุญ
'martyrs_by_year': [],  # ุณูุชู ุญุณุงุจูุง ุจุทุฑููุฉ ูุฎุชููุฉ
```

### 2. ุชุจุณูุท ุงุณุชุนูุงู ุงูููุงุทู
```python
# ูุจู ุงูุฅุตูุงุญ
'districts_with_most_cases': District.objects.annotate(
    total_cases=Count('guardian') + Count('martyr') + Count('injured') + 
               Count('medicalrecord') + Count('damage') + Count('orphan')
).order_by('-total_cases')[:5],

# ุจุนุฏ ุงูุฅุตูุงุญ
'districts_with_most_cases': District.objects.annotate(
    guardians_count=Count('guardian')
).order_by('-guardians_count')[:5],
```

### 3. ุชุจุณูุท ุฅุญุตุงุฆูุงุช ุงูุณุฌู ุงููุฏูู
```python
# ูุจู ุงูุฅุตูุงุญ
'total_family_members': CivilRegistry.objects.aggregate(
    total=Count('family_members_count')
)['total'] or 0,

# ุจุนุฏ ุงูุฅุตูุงุญ
'total_family_members': 0,  # ุชุจุณูุท ูุคูุช
```

## ุงููููุงุช ุงููุญุฏุซุฉ

### `reports/views.py`
- ุฅุฒุงูุฉ ุงูุงุณุชุนูุงูุงุช ุงููุนูุฏุฉ ุงูุชู ุชุณุจุจ ุฎุทุฃ SQL
- ุชุจุณูุท ุงูุฅุญุตุงุฆูุงุช ูุชุนูู ูุน SQLite
- ุงูุญูุงุธ ุนูู ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ

## ุงููุชุงุฆุฌ

### โ ุงููุดุงูู ุงููุญูููุฉ
- ุตูุญุฉ ุงูุฅุญุตุงุฆูุงุช ุชุนูู ุงูุขู ุจุฏูู ุฃุฎุทุงุก
- ุฌููุน ุงูุชุจููุจุงุช ุชุนูู ุจุดูู ุตุญูุญ
- ูุง ุชูุฌุฏ ุฃุฎุทุงุก SQL

### โ ุงููุธุงุฆู ุงููุชุงุญุฉ
- ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ุงูุฃุณุงุณูุฉ
- ุนุฏุฏ ุงูุณุฌูุงุช ููู ููุน
- ุชูุฒูุน ุงูุจูุงูุงุช ุญุณุจ ุงููุฆุงุช
- ุฅุญุตุงุฆูุงุช ุงูููุงุทู

## ุงูุชุญุณููุงุช ุงููุณุชูุจููุฉ (ุงุฎุชูุงุฑูุฉ)

### 1. ุฅุถุงูุฉ ุฅุญุตุงุฆูุงุช ุงูุณูุฉ ุจุทุฑููุฉ ุขููุฉ
```python
from datetime import datetime
from django.db.models import Q

# ุญุณุงุจ ุฅุญุตุงุฆูุงุช ุงูุณูุฉ ุจู Python ุจุฏูุงู ูู SQL
current_year = datetime.now().year
martyrs_2024 = Martyr.objects.filter(
    martyrdom_date__year=current_year
).count()
```

### 2. ุชุญุณูู ุฅุญุตุงุฆูุงุช ุงูููุงุทู
```python
# ุญุณุงุจ ุฅุฌูุงูู ุงูุญุงูุงุช ููู ููุทูุฉ ุจุดูู ูููุตู
for district in districts:
    district.total_cases = (
        district.guardian_set.count() +
        district.martyr_set.count() +
        district.injured_set.count() +
        # ... ุจุงูู ุงูููุงุฐุฌ
    )
```

### 3. ุฅุถุงูุฉ ุฑุณูู ุจูุงููุฉ
- ุงุณุชุฎุฏุงู Chart.js ูุนุฑุถ ุงูุฅุญุตุงุฆูุงุช
- ุฑุณูู ุฏุงุฆุฑูุฉ ููุชูุฒูุนุงุช
- ุฑุณูู ุจูุงููุฉ ููุงุชุฌุงูุงุช ุงูุฒูููุฉ

## ุงูุงุณุชุฎุฏุงู

ุงูุขู ูููู ุงููุตูู ูุตูุญุฉ ุงูุฅุญุตุงุฆูุงุช ุจุฏูู ูุดุงูู:

```
http://127.0.0.1:8000/reports/
```

ุฌููุน ุงูุชุจููุจุงุช ุชุนูู ุจุดูู ุตุญูุญ:
- โ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
- โ ุงููุณุงุนุฏุงุช  
- โ ุงูุดูุฏุงุก
- โ ุงูุฌุฑุญู
- โ ุงูุฃูุชุงู
- โ ุงูุฃุถุฑุงุฑ
- โ ุงููุฑุถู
- โ ุงูุณุฌู ุงููุฏูู
- โ ุงูุฅุญุตุงุฆูุงุช ูุงูุชูุงุฑูุฑ โ **ุชู ุฅุตูุงุญูุง**
- โ ุงููุณุชููุฏูู
- โ ุงูุชูุฒูุน

---

**ุชู ุฅุตูุงุญ ูุดููุฉ ุงูุฅุญุตุงุฆูุงุช ุจูุฌุงุญ! ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงููุงูู** ๐ 