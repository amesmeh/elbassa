# تحديثات تبويب المساعدات - ربط رقم الهوية مع الاسم

## المشكلة المطروحة
كان المستخدم يواجه مشكلة في تبويب المساعدات حيث:
1. عند تعديل رقم الهوية، لا يتم تحديث الاسم تلقائياً حسب البيانات الموجودة في أولياء الأمور
2. لا يظهر الاسم مع رقم الهوية في نفس السطر
3. عند التعديل في نفس السطر، يختفي رقم الهوية

## الحلول المطبقة

### 1. تحديث دالة التعديل السريع (`assistance_quick_edit`)
- إضافة دعم تعديل `national_id`
- التحقق من صحة رقم الهوية (9 أرقام)
- البحث التلقائي عن ولي الأمر برقم الهوية الجديد
- تحديث الاسم تلقائياً من قاعدة بيانات أولياء الأمور
- تحديث معلومات الحي وعدد أفراد العائلة
- إرجاع معلومات إضافية في الاستجابة

### 2. تحديث دالة الحصول على قيمة الحقل (`assistance_get_field_value`)
- إضافة دعم `national_id` للحصول على قيمته

### 3. تحديث واجهة المستخدم
- تعديل خلية رقم الهوية لتكون قابلة للتعديل
- عرض الاسم مع رقم الهوية في نفس الخلية
- تحديث JavaScript لتحديث عرض الاسم عند تعديل رقم الهوية

### 4. تحسينات JavaScript
- تحديث دالة `saveEdit` لتحديث عرض الاسم في خلية رقم الهوية
- تحديث دالة `updateCellContent` لعرض الاسم مع رقم الهوية
- معالجة تحديث البيانات في كلا الخليتين (الاسم ورقم الهوية)

## الميزات الجديدة

### ✅ تحديث تلقائي للاسم
عند تعديل رقم الهوية، يتم البحث تلقائياً في قاعدة بيانات أولياء الأمور وتحديث:
- اسم المستفيد
- اسم الحي
- عدد أفراد العائلة

### ✅ عرض الاسم مع رقم الهوية
في خلية رقم الهوية، يظهر:
- رقم الهوية بخط مميز
- اسم المستفيد أسفل رقم الهوية بخط أصغر

### ✅ تحديث متزامن
عند تعديل رقم الهوية:
- يتم تحديث خلية الاسم
- يتم تحديث خلية رقم الهوية مع الاسم الجديد
- يتم تحديث معلومات الحي وعدد أفراد العائلة

### ✅ التحقق من صحة البيانات
- التحقق من أن رقم الهوية 9 أرقام
- التحقق من أن الرقم يحتوي على أرقام فقط
- رسائل خطأ واضحة في حالة البيانات غير الصحيحة

## كيفية الاستخدام

1. **تعديل رقم الهوية:**
   - انقر مرتين على خلية رقم الهوية
   - أدخل الرقم الجديد (9 أرقام)
   - اضغط Enter أو انقر خارج الخلية
   - سيتم تحديث الاسم تلقائياً إذا وجد في قاعدة بيانات أولياء الأمور

2. **عرض المعلومات:**
   - في خلية رقم الهوية، ستظهر:
     - رقم الهوية بخط مميز
     - اسم المستفيد أسفل الرقم

3. **التحديث التلقائي:**
   - عند تغيير رقم الهوية، سيتم تحديث:
     - اسم المستفيد في خلية الاسم
     - اسم الحي (إذا كان متوفراً)
     - عدد أفراد العائلة (إذا كان متوفراً)

## الملفات المعدلة

1. `assistance/views.py`
   - دالة `assistance_quick_edit`
   - دالة `assistance_get_field_value`

2. `templates/assistance/assistance_list.html`
   - خلية رقم الهوية
   - دالة `saveEdit`
   - دالة `updateCellContent`

## ملاحظات تقنية

- يتم البحث في نموذج `Guardian` أولاً
- إذا لم يوجد ولي الأمر، يتم الاحتفاظ بالاسم الحالي
- يتم تحديث جميع الحقول المرتبطة تلقائياً
- يتم إرجاع معلومات إضافية في استجابة AJAX للتحكم في العرض

## الاختبار

يمكن اختبار الميزات الجديدة عبر:
1. الذهاب إلى `http://localhost:8000/assistance/`
2. النقر مرتين على خلية رقم الهوية لأي مساعدة
3. تغيير الرقم إلى رقم موجود في أولياء الأمور
4. ملاحظة تحديث الاسم تلقائياً
5. ملاحظة عرض الاسم مع رقم الهوية في نفس الخلية 